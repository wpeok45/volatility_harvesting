# Volatility harvesting (floating percent)

![alt text](pnl.png)

Bybit api spot bot

# installation
```
pip install -r requirements.txt
```
or 
```
python3 -m pip install -r requirements.txt
```
# prepare to run
Change .env file with your Bybit api and Telegram bot keys (Telegram is optional)

# run
```
python3 vh_float.py
```
or
```
docker-compose build && docker-compose up -d
```
--------------
Сбор волатильности на самом деле не сложная стратегия, но требующая переоценки
отношения к движению цен на рынке.

Она основывается на двух условиях:
1. Вероятность движения цены вверх или вниз за n времени, всегда равна "подбросу монетки" или 50/50.
    - мы намерено игнорируем все другие условия, считая их внешними ( например политическая обстановка, новости или манипуляции рынком)
    - обьем рынка BTC и количество участников настолько огромно, что любое внешнее влияние неизбежно будет сбалансировано в той или иной мере.
2. Экстремальные колебания цены( например 60k$, 16k$, 100k$) происходят в приемлемом временном диапазоне.
    - это значит что периоды падения и подьема не длятся десятилетиями

Bitcoin хорошо соответствует этим условиям. Далее рассмотрим какие стратегии содержит внутри себя Volatility harvesting.
### HODL
Что если бы мы покупали BTC обьемом 1$ за каждый пункт цены начиная от 10к до 60к, по мере её повышения.
Мы бы заплатили 50000$ по средней цене 35к$ и были бы в хорошей прибыли. Это стандартная HODL стратегия.
По мере снижения цены до 16к портфель понесет убытки.
### DCA
Что если мы внесем небольшую коррекцию в HODL и будем продавать наш каждый купленый BTC(1$) если его цена увеличится на 10%.
Это будет стандартная стратегия greed DCA
### VA
Теперь попробуем покупать больше чем BTC(1$) и продавать меньше чем BTC(1$), по мере снижения цены и наоборот - покупать меньше и продавать больше
по мере повышения цены. Это будет близко к стратегии DVA или VA

Следует учесть что DCA и DVA считаются инвестиционными стратегиями. Тоесть попросту это способ входа на рынок, с помощью него постоянно увеличивают обьем
BTC в портфеле через определенные периоды или через диапазоны изменения цены (например "по сетке")
### Volatility harvesting
Мы просто следим чтобы портфель всегда был 50% / 50%.
Проводя ребалансировку на изменении соотношения в портфеле. Например если цена актива выросла и стало 60% / 40%, то мы продаем 
актив на 10%, тем самым восстанавливая баланс 50% / 50%.

Очевидно что BTC у всех этих стратегий "залеживается на складе", говоря терминологией обычного магазина розничной торговли.
Наша цель продать всё что мы покупали, с прибылью и как можно скорей и эффективней, как в swing trading.
Мы не будем рассматривать стратегии где присутствует "ошибка выжившего", например основаных на тренде.
Но хотелось бы чтобы работало "всё само по себе", без утомительного теханализа и чтения новостей.
Нужна универсальная формула, полностью соблюдающая математические вероятности.

 ### Формула балансировки портфеля с нулевым риском:
```
if BTC price = 0.01$ then portfolio balance ratio = 100% (BTC) / 0% (USDT)
if BTC price = ATH then portfolio balance ratio = 0% (BTC) / 100% (USDT)
```
Если мы хотим рискнуть для повышения прибыли, то можем ограничить диапазон на половину:
```
if BTC price = ATH/2 $ then portfolio balance ratio = 100% (BTC) / 0% (USDT)
if BTC price = ATH then portfolio balance ratio = 0% (BTC) / 100% (USDT)
```

### Volatility harvesting with floating ratio
```
Начальное состояние портфеля BTC = 0.0, STABLE_PAIR = 1000.0 USD
TOTAL_AMOUNT = 1000 USD
BTC price = ATH (100000 USD)
RATIO = 0.0
RANGE = 100000

Стоимость каждого pip цены:
    TOTAL_AMOUNT / RANGE = 0.01 USD
    Если цена упадет на 1000 pips, то мы купим 1000 * ~0.01 = 10 USD

RATIO_PER_PIP = 1.0 / RANGE = 0.00001
Каждый тик будет менять соотношение в портфеле как RATIO +(-) RATIO_PER_PIP
Допустим что цена упала на 500 pips:
RATIO += 500 * 0.00001 = 0,005
Теперь баланс в портфеле будет BTC = 0.5%, STABLE_PAIR = 99.5%
```
На ATH у нас 0% / 100% и по мере снижения цены, у нас будет расти % слева и уменьшаться % справа

Когда производится Ребаланс портфеля: 
- продажу BTC проводим на приемлемом изменении процента, не менее 2% (если fee = 0.1)
- sell or buy делаем на разворотах цены, например по пересечению EMA24 и MA24
- чтобы избежать ложного разворота проверяем локальный диапазон цены например за 2 часа.



Универсальней этой формулы трудно что-то себе представить.
Похоже что эффективные трейдеры и крупные фонды придерживаются ее в подавляющем большинстве случаев.
Даже intraday трейдеры на коротких диапазонах, скорее всего интуитивно следуют этой формуле.

Не является финансовым советом. Используйте на свой страх и риск.

